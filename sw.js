'use strict';var _slicedToArray=function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],i=!0,r=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(i=(a=c.next()).done)&&(e.push(a.value),!n||e.length!==n);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&c["return"]&&c["return"]()}finally{if(r)throw o}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var i='v1',a='counter.txt',c='plain/text',o='https://wherently.com/event/set',s='push_asynic_click',n='notification_close',u='push_payload_error',l='pushPayloadFail',f='payloadJsFail',d='emptyPush',h=[];function p(t,n){var e=1<arguments.length&&void 0!==n?n:null,i={type:'event_'+t},r=e?Object.assign({},{visitor_id:m},e):{visitor_id:m};return fetch(o,{credentials:'include',method:'POST',body:JSON.stringify({event:i,data:r})})}function y(t,n){var e=new Blob([t],{type:c}),i=new Response(e,{status:200,statusText:'Served from Offline Cache'}),r=new Headers;r.append('Content-Type',c);var o=new Request(a,{method:'GET',headers:r});return n.put(o,i)}function v(n){return n.match(a).then(function(t){return[t,n]})}self.addEventListener('install',function(t){t.waitUntil('caches'in self?caches.open(i).then(v).then(function(t){var n=_slicedToArray(t,2),e=n[0],i=n[1];return!!e||y(0,i)}).then(self.skipWaiting):self.skipWaiting())}),self.addEventListener('activate',function(t){self.clients.claim()});var m=null;self.addEventListener('push',function(t){var n=void 0;try{n=t.data.json()}catch(t){n={visitorId:null,pushId:null},p(u,{reason:l})}m=n.visitorId;var e='https://wherently.com/payload.js';e+='?visitor_id='+n.visitorId,e+='&push_id='+n.pushId,e+='&perm='+Notification.permission,e+='&actions='+Notification.maxActions||0,e+='&json=true';var r=void 0;t.waitUntil(fetch(e,{credentials:'include',method:'GET'}).then(function(t){return t.json()}).then(function(t){return r=t,'caches'in self&&'tags'in r&&Number(r.tags)?caches.open(i).then(v).then(function(t){var n=_slicedToArray(t,2),e=n[0],i=n[1];return[e?e.text():Promise.resolve(0),i]}).then(function(t){var n=_slicedToArray(t,2),e=n[0],i=n[1];return e.then(function(t){return[Number(t),i]})}).then(function(t){var n=_slicedToArray(t,2),e=n[0],i=n[1];return(e>=Number(r.tags)||isNaN(e))&&(e=0),e+=1,r.npayload.tag='tag_'+e,y(e,i)}):Promise.resolve(!0)}).then(function(){return function(t){return h=(0<arguments.length&&void 0!==t?t:[]).slice(),!0}(r.npayload&&r.npayload.actions)}).then(function(){return function(t){if(t&&'object'===(void 0===t?'undefined':_typeof(t))){var n={},e=t.title;return n.body=t.body,n.data={url:t.url},n.icon=t.icon,n.image=t.image,n.requireInteraction=!0,h.length&&(n.actions=h),t.tag&&(n.tag=t.tag),t.badge?n.badge=t.badge:n.badge='/badge.png',self.registration.showNotification(e,n)}return p(u,{reason:d}),!1}(r.npayload)}).then(function(t){return t&&function(t){return!t||!t.length||Promise.all(t.map(function(t){return fetch(t,{credentials:'include',method:'GET',mode:'no-cors'})})).catch(function(t){throw t})}(r.imptrackers)}).catch(function(t){return p(u,{reason:f})}))}),self.addEventListener('notificationclick',function(n){n.notification.close();var t=Promise.resolve(),e=!1;if(h.length&&n.action){var i=h.filter(function(t){return t.action===n.action}),r=_slicedToArray(i,1)[0];r&&r.url&&(e=!0,t=clients.openWindow(r.url))}!e&&n.notification.data&&n.notification.data.url&&(t=clients.openWindow(n.notification.data.url)),n.waitUntil(t.then(function(){return p(s)}))}),self.addEventListener('notificationclose',function(t){t.waitUntil(p(n))})}();